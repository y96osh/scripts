<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Conversor SRT (Fiel ao Programa)</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 40px; max-width: 800px; margin: auto; }
    textarea { width: 100%; height: 250px; margin-bottom: 20px; }
    button { padding: 10px 20px; font-size: 16px; margin-right: 10px; }
    pre { background: #f0f0f0; padding: 20px; white-space: pre-wrap; }
  </style>
</head>
<body>

  <h2>Conversor de Texto para SRT (Compatível com CapCut)</h2>
  <textarea id="inputText" placeholder="Cole seu texto aqui..."></textarea><br>
  <button onclick="converterParaSRT()">Converter</button>
  <button id="botaoBaixar" onclick="baixarSRT()" disabled>Baixar SRT</button>

  <h3>Resultado:</h3>
  <pre id="srtOutput"></pre>

  <script>
    let srtFinal = '';

    function formatarTempo(segundos) {
      const h = String(Math.floor(segundos / 3600)).padStart(2, '0');
      const m = String(Math.floor((segundos % 3600) / 60)).padStart(2, '0');
      const s = String(segundos % 60).padStart(2, '0');
      return `${h}:${m}:${s},000`;
    }

    function dividirFrases(texto) {
      return texto.match(/[^.!?]+[.!?]+/g) || [];
    }

    function agruparFrasesComLimite(frases, limite) {
      const blocos = [];
      let atual = '';

      for (let frase of frases) {
        if ((atual + ' ' + frase).trim().length <= limite) {
          atual += (atual ? ' ' : '') + frase.trim();
        } else {
          if (atual) blocos.push(atual.trim());
          atual = frase.trim();
        }
      }

      if (atual) blocos.push(atual.trim());

      return blocos;
    }

    function converterParaSRT() {
      const texto = document.getElementById("inputText").value.replace(/\n+/g, ' ').trim();
      if (!texto) {
        document.getElementById("botaoBaixar").disabled = true;
        return;
      }

      const frases = dividirFrases(texto);
      const blocos = agruparFrasesComLimite(frases, 500);

      let srt = '';
      let tempoInicio = 0;

      blocos.forEach((bloco, i) => {
        const inicio = formatarTempo(tempoInicio);
        const fim = formatarTempo(tempoInicio + 30);
        srt += `${i + 1}\n${inicio} --> ${fim}\n${bloco}\n\n`;
        tempoInicio += 40; // 30s + 10s de intervalo
      });

      srtFinal = srt;
      document.getElementById("srtOutput").textContent = srt;

      // Habilita o botão de download após conversão
      document.getElementById("botaoBaixar").disabled = false;
    }

    async function baixarSRT() {
      if (window.showSaveFilePicker) {
        try {
          const opts = {
            suggestedName: 'legenda_capcut.srt',
            types: [{
              description: 'Arquivo SRT',
              accept: { 'text/plain': ['.srt'] }
            }]
          };
          const handle = await window.showSaveFilePicker(opts);
          const writable = await handle.createWritable();
          await writable.write(srtFinal);
          await writable.close();
        } catch (err) {
          console.error('Não foi possível salvar via File System API:', err);
        }
      } else {
        const blob = new Blob([srtFinal], { type: 'text/plain;charset=utf-8' });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "legenda_capcut.srt";
        link.click();
      }
    }

    // Desativa o botão de download se o campo de texto for apagado
    document.getElementById("inputText").addEventListener("input", function () {
      const texto = this.value.trim();
      if (!texto) {
        document.getElementById("srtOutput").textContent = '';
        document.getElementById("botaoBaixar").disabled = true;
      }
    });
  </script>

</body>
</html>
